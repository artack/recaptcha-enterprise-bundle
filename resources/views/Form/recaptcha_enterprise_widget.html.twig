{% block recaptcha_enterprise_widget %}
    <div>start</div>

    {%- set type = type|default('hidden') -%}
    {{ block('form_widget_simple') }}

    <script src="https://www.google.com/recaptcha/enterprise.js?render={{ form.vars.site_key }}"></script>
    <script>
        const recaptchaTokenField = document.getElementById('{{ form.vars.id }}');
        const recaptchaForm = recaptchaTokenField.closest('form');
        
        if (recaptchaForm) {
            recaptchaForm.addEventListener('submit', async (event) => {
                event.preventDefault();
                grecaptcha.enterprise.ready(async () => {
                    recaptchaTokenField.value = await grecaptcha.enterprise.execute('{{ form.vars.site_key }}', {action: '{{ form.vars.action }}'});
                    recaptchaForm.submit();
                });
            });
        }
    </script>

    <div>end</div>
{% endblock %}
